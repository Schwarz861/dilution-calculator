<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¬¡æ°¯é…¸æ°´ç¨€é‡‹æ¿ƒåº¦è¨ˆç®—å™¨ | HOCl Dilution Calculator</title>
  <style>
    :root {
      --bg-color: #F0F8FF;
      --text-color: #333;
      --container-bg: #FFF;
      --input-bg: #FFF;
      --button-bg: #005EB8;
      --button-hover-bg: #004799;
      --result-bg: #E6F2FF;
      --result-border: #005EB8;
    }
    @media (prefers-color-scheme: dark) {
      :root:not([data-theme]) {
        --bg-color: #121212;
        --text-color: #EEE;
        --container-bg: #1E1E1E;
        --input-bg: #2E2E2E;
        --button-bg: #333;
        --button-hover-bg: #555;
        --result-bg: #333;
        --result-border: #EEE;
      }
    }
    :root[data-theme="dark"] {
      --bg-color: #121212;
      --text-color: #EEE;
      --container-bg: #1E1E1E;
      --input-bg: #2E2E2E;
      --button-bg: #333;
      --button-hover-bg: #555;
      --result-bg: #333;
      --result-border: #EEE;
    }
    body {
      margin: 0; padding: 20px;
      font-family: 'Noto Sans TC', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background 0.3s, color 0.3s;
    }
    .container {
      max-width: 500px; width: 90%; margin: auto;
      background: var(--container-bg);
      padding: 30px; border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: background 0.3s;
    }
    .control-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      flex-wrap: nowrap;
    }
    .top-controls {
      display: flex;
      gap: 10px;
      flex-wrap: nowrap;
    }
    .top-controls button {
      white-space: nowrap;
      padding: 6px 12px;
      font-size: 0.9em;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: var(--button-bg);
      color: #fff;
      transition: background 0.3s;
    }
    .top-controls button:hover {
      background: var(--button-hover-bg);
    }
    h1 {
      text-align: center;
      font-size: 1.6em;
      margin-bottom: 10px;
    }
    label {
      font-weight: bold;
      font-size: 1.1em;
      margin: 0;
    }
    input {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid #ccc;
      background: var(--input-bg);
      color: var(--text-color);
      transition: background 0.3s, color 0.3s;
    }
    .result {
      margin-top: 25px; padding: 20px; font-size: 1.3em;
      font-weight: bold; text-align: center;
      background: var(--result-bg);
      border: 1px solid var(--result-border);
      border-radius: 10px; min-height: 1.5em;
      transition: background 0.3s, border-color 0.3s;
    }
    .buttons {
      display: flex; justify-content: space-between;
      flex-wrap: wrap; gap: 10px; margin-top: 30px;
    }
    .buttons button {
      flex: 1; padding: 16px 0; font-size: 1.2em;
      border: none; border-radius: 8px;
      background: var(--button-bg); color: #fff;
      cursor: pointer; transition: background 0.3s;
    }
    .buttons button:hover { background: var(--button-hover-bg); }
    @media (max-width: 480px) {
      .control-row { flex-direction: column; align-items: flex-start; }
      .top-controls { margin-top: 8px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="title"></h1>
    <div class="control-row">
      <label for="c1" id="label-c1"></label>
      <div class="top-controls">
        <button id="theme-toggle"></button>
        <button id="lang-toggle"></button>
      </div>
    </div>
    <input type="number" id="c1" value="2000">

    <label for="c2" id="label-c2"></label>
    <input type="number" id="c2" placeholder="">

    <label for="v2" id="label-v2"></label>
    <input type="number" id="v2" placeholder="">

    <div class="result" id="result"></div>
    <div class="buttons">
      <button id="btn-calc"></button>
      <button id="btn-copy"></button>
    </div>
  </div>
  <script>
    const texts = {
      zh: {
        title: 'æ¬¡æ°¯é…¸æ°´ç¨€é‡‹æ¿ƒåº¦è¨ˆç®—å™¨',
        labelC1: 'åŽŸå§‹æ¿ƒåº¦ (ppm)ï¼š',
        labelC2: 'ç›®æ¨™æ¿ƒåº¦ (ppm)ï¼š',
        labelV2: 'ç›®æ¨™æ°´é‡ (å…¬å‡)ï¼š',
        phC2: 'è«‹è¼¸å…¥ç›®æ¨™æ¿ƒåº¦',
        phV2: 'è«‹è¼¸å…¥ç›®æ¨™æ°´é‡',
        btnCalc: 'ðŸ” è¨ˆç®—',
        btnCopy: 'ðŸ“‹ è¤‡è£½çµæžœ',
        resultPrefix: 'éœ€è¦åŠ å…¥çš„åŽŸæ¶²é‡ç‚ºï¼š',
        mlText: 'ç›¸ç•¶æ–¼',
        mlUnit: 'æ¯«å‡',
        alertCopied: 'çµæžœå·²è¤‡è£½ï¼',
        alertError: 'è«‹å…ˆè¨ˆç®—çµæžœå†è¤‡è£½ï¼',
        themeLight: 'â˜€ï¸ æ·ºè‰²æ¨¡å¼',
        themeDark: 'ðŸŒ™ æ·±è‰²æ¨¡å¼',
        langToggle: 'EN'
      },
      en: {
        title: 'HOCl Dilution Calculator',
        labelC1: 'Original Concentration (ppm):',
        labelC2: 'Target Concentration (ppm):',
        labelV2: 'Target Volume (L):',
        phC2: 'Enter target concentration',
        phV2: 'Enter target volume',
        btnCalc: 'ðŸ” Calculate',
        btnCopy: 'ðŸ“‹ Copy Result',
        resultPrefix: 'Required Volume:',
        mlText: 'Equivalent to',
        mlUnit: 'mL',
        alertCopied: 'Result copied!',
        alertError: 'Please calculate before copying!',
        themeLight: 'â˜€ï¸ Light Mode',
        themeDark: 'ðŸŒ™ Dark Mode',
        langToggle: 'ä¸­'
      }
    };
    let currentLang = localStorage.getItem('lang') || 'zh';
    function applyLanguage() {
      const t = texts[currentLang];
      document.getElementById('title').textContent = t.title;
      document.getElementById('label-c1').textContent = t.labelC1;
      document.getElementById('label-c2').textContent = t.labelC2;
      document.getElementById('label-v2').textContent = t.labelV2;
      document.getElementById('c2').placeholder = t.phC2;
      document.getElementById('v2').placeholder = t.phV2;
      document.getElementById('btn-calc').textContent = t.btnCalc;
      document.getElementById('btn-copy').textContent = t.btnCopy;
      document.getElementById('lang-toggle').textContent = t.langToggle;
      updateThemeBtn();
      calculate();
    }
    function toggleLanguage() {
      currentLang = currentLang === 'zh' ? 'en' : 'zh';
      localStorage.setItem('lang', currentLang);
      applyLanguage();
    }
    document.getElementById('lang-toggle').addEventListener('click', toggleLanguage);
    function initTheme() {
      const saved = localStorage.getItem('theme');
      if (['light','dark'].includes(saved)) {
        document.documentElement.setAttribute('data-theme', saved);
      }
      updateThemeBtn();
    }
    function toggleTheme() {
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      updateThemeBtn();
    }
    function updateThemeBtn() {
      const t = texts[currentLang];
      const btn = document.getElementById('theme-toggle');
      const cur = document.documentElement.getAttribute('data-theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark':'light');
      btn.textContent = cur === 'dark' ? t.themeLight : t.themeDark;
    }
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    function calculate() {
      const c1 = parseFloat(document.getElementById('c1').value);
      const c2Val = document.getElementById('c2').value;
      const v2Val = document.getElementById('v2').value;
      const resultEl = document.getElementById('result');
      if (!c2Val || !v2Val) { resultEl.innerHTML = ''; return; }
      const c2 = parseFloat(c2Val), v2 = parseFloat(v2Val);
      const v1 = (c2 * v2) / c1;
      const v1Str = parseFloat(v1.toFixed(6)).toString();
      const t = texts[currentLang];
      let html = `${t.resultPrefix} ${v1Str} ${currentLang==='zh'?'å…¬å‡':'L'}`;
      const dec = v1Str.includes('.') ? v1Str.split('.')[1].length : 0;
      if (dec > 2) {
        const ml = parseFloat((v1 * 1000).toFixed(6)).toString();
        html += `<br>${t.mlText} ${ml} ${t.mlUnit}`;
      }
      resultEl.innerHTML = html;
    }
    function copyResult() {
      const t = texts[currentLang];
      const text = document.getElementById('result').innerText.replace(/\n/g,' ');
      if (!text) { alert(t.alertError); return; }
      if (navigator.clipboard) navigator.clipboard.writeText(text).then(() => alert(t.alertCopied)).catch(() => fallback(text));
      else fallback(text);
    }
    function fallback(txt) { const ta = document.createElement('textarea'); ta.value = txt; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); alert(texts[currentLang].alertCopied); }
    document.getElementById('btn-calc').addEventListener('click', calculate);
    document.getElementById('btn-copy').addEventListener('click', copyResult);
    applyLanguage(); initTheme();
  </script>
</body>
</html>
