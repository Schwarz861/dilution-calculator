<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>次氯酸水稀釋濃度計算器 | HOCl Dilution Calculator</title>
  <style>
    /* 全域樣式重置 */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; overflow-x: hidden; }
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: #F0F8FF;
      color: #333;
      padding: 20px;
      transition: background .3s, color .3s;
    }
    /* 主題變數 */
    :root {
      --bg-color: #F0F8FF;
      --text-color: #333;
      --glass-bg: rgba(255,255,255,0.8);
      --glass-border: rgba(255,255,255,0.5);
      --primary-grad: linear-gradient(135deg, #4e7cf3, #1f59d8);
      --primary-grad-hover: linear-gradient(135deg, #1f59d8, #4e7cf3);
      --clear-grad: linear-gradient(135deg, #fff176, #ffee58);
      --clear-grad-hover: linear-gradient(135deg, #ffee58, #fff176);
      --shadow: rgba(0,0,0,0.15);
    
      --btn-bg: #ffffff;
      --btn-text: #333333;
      --btn-shadow: rgba(0, 0, 0, 0.08);
    }
    [data-theme="dark"] {
      --bg-color: #121212;
      --text-color: #EEE;
      --glass-bg: rgba(30,30,30,0.8);
      --glass-border: rgba(255,255,255,0.2);
    
      --btn-bg: #2e2e2e;
      --btn-text: #eeeeee;
      --btn-shadow: rgba(0, 0, 0, 0.5);
    
      /* 按鈕維持淺色 */
      --btn-bg: #ffffff;
      --btn-text: #333333;
      --btn-shadow: rgba(0, 0, 0, 0.08);
    
      /* 深色模式下按鈕背景變更為半透明深灰 */
      --btn-bg: rgba(255,255,255,0.1);
      --btn-text: #fff;
      --btn-shadow: rgba(0,0,0,0.5);
    
      /* 深色模式下輸入框與結果區塊明顯對比 */
      --input-bg: rgba(50,50,50,0.9);
      --glass-bg: rgba(30,30,30,0.95);
      --result-bg: rgba(40,40,40,0.95);
      --glass-border: rgba(255,255,255,0.2);
    }
    body { background: var(--bg-color); color: var(--text-color); }
    /* 容器 */
    .container {
      max-width: 500px;
      width: 100%;
      margin: 20px auto;
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 60px 30px 30px;
      position: relative;
      box-shadow: 0 8px 20px var(--shadow);
    }
    /* 上方主題及語言切換 */
    .top-controls {
      position: absolute;
      top: 16px;
      right: 16px;
      display: flex;
      gap: 8px;
    }
    .top-controls button {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      background: var(--primary-grad);
      color: #fff;
      font-size: 0.9em;
      cursor: pointer;
      box-shadow: 0 4px 12px var(--shadow);
      transition: background .3s;
    }
    .top-controls button:hover { background: var(--primary-grad-hover); }
    /* 標題 */
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.6em;
    }
    /* 標籤及輸入框 */
    label {
      display: block;
      margin-top: 12px;
      margin-bottom: 8px;
      font-weight: bold;
    }
    input {
      width: 100%;
      padding: 12px;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.1);
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.1);
      color: var(--text-color);
    ; background: var(--input-bg) !important; border: 1px solid rgba(255,255,255,0.2) !important; }
    /* 結果區塊 */
    .result {
      margin-top: 20px;
      padding: 20px;
      font-size: 1.1em;
      font-weight: bold;
      line-height: 1.6;
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      border: none;
      border-radius: 12px;
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.1);
      color: var(--text-color);
    ; background: var(--result-bg) !important; border: 1px solid rgba(255,255,255,0.2) !important; }
    /* 按鈕列 */
    .buttons {
      display: flex;
      justify-content: space-evenly; /* 改為平均間隔 */
      gap: 16px;
      margin-top: 30px;
    }
    .buttons button {
      flex: none; /* 取消平均寬度，回歸自動撐開 */
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      height: 48px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      /* 透明毛玻璃材質 */
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      /* 防止文字換行 */
      white-space: nowrap;
      color: var(--text-color);
      box-shadow: 0 4px 8px var(--btn-shadow);
      cursor: pointer;
      transition: filter .3s, transform .1s;
    
      /* 固定寬度，確保中英文相同 */
      width: 120px;
      white-space: nowrap;
          min-width: 140px; /* 防止英文被裁切 */      overflow: visible; /* 顯示完整內容 */    }
    #btn-calc { border: 2px solid transparent; border-image: var(--primary-grad) 1; }
    #btn-calc:hover { border-image: var(--primary-grad-hover) 1; }
    #btn-clear { border: 2px solid transparent; border-image: var(--clear-grad) 1; }
    #btn-clear:hover { border-image: var(--clear-grad-hover) 1; }
    #btn-copy {$1; font-size: 0.9em; /* 微調字體，避免溢出 */}
    #btn-copy:hover { border-image: var(--primary-grad-hover) 1; }
    /* 響應式 */
    /* 強制覆蓋底部按鈕漸層樣式為純色 */
    #btn-calc, #btn-clear, #btn-copy {
      border: none !important;
      background: var(--btn-bg) !important;
      color: var(--btn-text) !important;
      box-shadow: 0 2px 4px var(--btn-shadow) !important;
    }
    #btn-calc:hover, #btn-clear:hover, #btn-copy:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    @media (max-width: 480px) {
      .container { padding: 60px 20px 20px; }
      .top-controls { position: static; justify-content: flex-end; margin-bottom: 20px; }
      .buttons { flex-wrap: wrap; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-controls">
      <button id="theme-toggle"></button>
      <button id="lang-toggle"></button>
    </div>
    <h1 id="title"></h1>
    <label id="label-c1" for="c1"></label>
    <input id="c1" type="number" value="2000" />
    <label id="label-c2" for="c2"></label>
    <input id="c2" type="number" placeholder="" />
    <label id="label-v2" for="v2"></label>
    <input id="v2" type="number" placeholder="" />
    <div class="result" id="result"></div>
    <div class="buttons">
      <button id="btn-calc"></button>
      <button id="btn-clear"></button>
      <button id="btn-copy"></button>
    </div>
  </div>
  <script>
    const texts = {
      zh: {
        title: '次氯酸水稀釋濃度計算器',
        labelC1: '原始濃度 (ppm)：',
        labelC2: '目標濃度 (ppm)：',
        labelV2: '目標水量 (公升)：',
        phC2: '請輸入目標濃度',
        phV2: '請輸入目標水量',
        btnCalc: '🔁 計算',
        btnClear: '🗑️ 清除',
        btnCopy: '📋 複製結果',
        resultPrefix: '需要加入的原液量為：',
        mlText: '相當於',
        mlUnit: '毫升',
        errorStock: '原液濃度低於目標濃度，<br>需用更高濃度進行稀釋。',
        alertCopied: '結果已複製！',
        alertError: '請先計算結果再複製！',
        themeLight: '☀️ 淺色模式',
        themeDark: '🌙 深色模式',
        langToggle: 'EN'
      },
      en: {
        title: 'HOCl Dilution Calculator',
        labelC1: 'Original Concentration (ppm):',
        labelC2: 'Target Concentration (ppm):',
        labelV2: 'Target Volume (L):',
        phC2: 'Enter target concentration',
        phV2: 'Enter target volume',
        btnCalc: '🔁 Calculate',
        btnClear: '🗑️ Clear',
        btnCopy: '📋 Copy Result',
        resultPrefix: 'Required Volume:',
        mlText: 'Equivalent to',
        mlUnit: 'mL',
        errorStock: 'Original concentration is lower than target concentration.<br>Please use a higher concentration<br>stock to dilute.',
        alertCopied: 'Result copied!',
        alertError: 'Please calculate before copying!',
        themeLight: '☀️ Light Mode',
        themeDark: '🌙 Dark Mode',
        langToggle: '中'
      }
    };
    let lang = localStorage.getItem('lang') || 'zh';
    function applyLanguage() {
      const t = texts[lang];
      document.getElementById('title').textContent = t.title;
      document.getElementById('label-c1').textContent = t.labelC1;
      document.getElementById('label-c2').textContent = t.labelC2;
      document.getElementById('label-v2').textContent = t.labelV2;
      document.getElementById('c2').placeholder = t.phC2;
      document.getElementById('v2').placeholder = t.phV2;
      document.getElementById('btn-calc').textContent = t.btnCalc;
      document.getElementById('btn-clear').textContent = t.btnClear;
      document.getElementById('btn-copy').textContent = t.btnCopy;
      document.getElementById('lang-toggle').textContent = t.langToggle;
      updateThemeBtn(); calculate();
    }
    function toggleLanguage() {
      lang = lang === 'zh' ? 'en' : 'zh';
      localStorage.setItem('lang', lang);
      applyLanguage();
    }
    document.getElementById('lang-toggle').addEventListener('click', toggleLanguage);
    function updateThemeBtn() {
      const t = texts[lang];
      const btn = document.getElementById('theme-toggle');
      const cur = document.documentElement.getAttribute('data-theme') ||
                  (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      btn.textContent = cur === 'dark' ? t.themeLight : t.themeDark;
    }
    function initTheme() {
      const saved = localStorage.getItem('theme');
      if (['light','dark'].includes(saved)) document.documentElement.setAttribute('data-theme', saved);
      updateThemeBtn();
    }
    function toggleTheme() {
      const cur = document.documentElement.getAttribute('data-theme');
      const next = cur === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      updateThemeBtn();
    }
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    function calculate() {
      const c1 = parseFloat(document.getElementById('c1').value);
      const c2v = document.getElementById('c2').value;
      const v2v = document.getElementById('v2').value;
      const res = document.getElementById('result');
      const t = texts[lang];
      if (!c2v || !v2v) { res.innerHTML = ''; return; }
      const c2 = parseFloat(c2v);
      if (c1 < c2) { res.innerHTML = t.errorStock; return; }
      const v2 = parseFloat(v2v);
      const v1 = (c2 * v2) / c1;
      const v1s = parseFloat(v1.toFixed(6)).toString();
      let html = `${t.resultPrefix} ${v1s} ${lang === 'zh' ? '公升' : 'L'}`;
      const dec = v1s.includes('.') ? v1s.split('.')[1].length : 0;
      if (dec > 2) {
        const ml = parseFloat((v1 * 1000).toFixed(6)).toString();
        html += `<br>${t.mlText} ${ml} ${t.mlUnit}`;
      }
      res.innerHTML = html;
    }
    function clearFields() {
      document.getElementById('c2').value = '';
      document.getElementById('v2').value = '';
      document.getElementById('result').innerHTML = '';
    }
    document.getElementById('btn-clear').addEventListener('click', clearFields);
    function copyResult() {
      const t = texts[lang];
      const txt = document.getElementById('result').innerText.replace(/\n/g, ' ');
      if (!txt) { alert(t.alertError); return; }
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(txt).then(() => alert(t.alertCopied)).catch(() => fallback(txt));
      } else fallback(txt);
    }
    function fallback(txt) {
      const ta = document.createElement('textarea');
      ta.value = txt;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      alert(texts[lang].alertCopied);
    }
    document.getElementById('btn-calc').addEventListener('click', calculate);
    document.getElementById('btn-copy').addEventListener('click', copyResult);
    applyLanguage(); initTheme();
  </script>
</body>
</html>
